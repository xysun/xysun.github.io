<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="description" content="I strove for none, for none was worth my strife.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Do Nothing | Do Nothing</title>

    
            <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="assets/css/code.css" rel="stylesheet" type="text/css">
        <link href="assets/css/colorbox.css" rel="stylesheet" type="text/css">
        <link href="assets/css/theme.css" rel="stylesheet" type="text/css">

    
            <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">

      <link rel="canonical" href="https://xysun.github.io/index.html">



        <link rel="next" href="index-1.html" type="text/html">

    
        <!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->

    




</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://xysun.github.io">

                <span id="blog-title">Do Nothing</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li class="active">
<a href="#">Home</a>
                </li>
<li>
<a href="stories/about.html">About</a>
                </li>
<li>
<a href="categories/index.html">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS</a>

                
            </li>
</ul>

            <ul class="nav navbar-nav navbar-right">
                
                
                    
                
            </ul>
        </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav>

<!-- End of Menubar -->

<div class="container" id="content">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<div class="postindex">
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/selenium-auto-tests-on-server.html" class="u-url">Running automated selenium tests on Debian server</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/selenium-auto-tests-on-server.html" rel="bookmark"><time class="published dt-published" datetime="2014-09-21T13:11:27+00:00" itemprop="datePublished" title="Publication date">2014-09-21 13:11</time></a></p>
                <p class="commentline">
        
    <a href="posts/selenium-auto-tests-on-server.html#disqus_thread" data-disqus-identifier="cache/posts/selenium-auto-tests-on-server.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<p>In the startup I work we use <a href="http://www.seleniumhq.org/">selenium</a> for automated web testing. Previously the testing flow involves manually open the selenium plugin in firefox, set the environment-specific variables and click the "Play entire test suite" button. Recently I migrated the task to a Debian server which frees us from manual work and enables us to do much more, eg. test scheduling, integrating to the deployment process, etc. </p>
<p>Below is my notes on achieving this.</p>
<h4>Running selenium headless</h4>
<p>Selenium normally requires a display. On a Linux server, I use <a href="http://www.x.org/archive/X11R7.7/doc/man/man1/Xvfb.1.xhtml">xvfb</a> to simulate the display. The command is:</p>
<pre class="code literal-block">xvfb-run --server-num<span class="o">=</span>10 &lt;python commands here&gt;
</pre>


<p>eg:</p>
<pre class="code literal-block">xvfb-run --server-num<span class="o">=</span>10 python -m unittest discover --pattern<span class="o">=</span>*.py
</pre>


<p>I have also found out that the method <code>driver.find_element_by_link_text</code> often fails with the message "cannot scroll into view". I have tried the fix with <code>maximize_window</code> and <code>window.scrollTo(x, y)</code> but with no luck. In the end I have to replace some of the clicks with <code>driver.get(url)</code> calls. </p>
<h4>POST request in logged in session</h4>
<p>Selenium does not support POST request naturally (if it does please let me know!), this is a bit of headache when some jquery POST calls need to be tested within a logged in session. </p>
<p>Luckily we use cookies to verify logged in sessions and thus can have the super awesome <a href="http://docs.python-requests.org/en/latest/">requests</a> library to the rescue.</p>
<p>The tricky part(I am not sure if it is a universal case) is that when I login through POST request to our authenticate service, the returned cookie cannot be found in the <code>request.cookies</code>, rather it is part of the <code>r.request.headers['Cookie']</code>. </p>
<p>So for example to test the <code>like</code> button in a post (something similar to the facebook <code>like</code> button):</p>
<pre class="code literal-block"><span class="c"># step1 login</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">authen_url</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'username'</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="s">'password'</span><span class="p">:</span> <span class="n">password</span><span class="p">})</span>

<span class="c"># get cookie from headers </span>
<span class="c"># note r.request.headers['Cookie'] is a comma separated string</span>
<span class="c"># eg: name1=val1; name2=val2</span>
<span class="n">cookie_str</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'Cookie'</span><span class="p">]</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cookie_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">';'</span><span class="p">):</span>
    <span class="n">cname</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'='</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cval</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'='</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cookies</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="n">cval</span>

<span class="c"># step2 test other functions with the obtained cookie</span>
<span class="c"># eg. a "like" POST function here</span>
<span class="n">u</span> <span class="o">=</span> <span class="s">'domain.com/service/likefeed'</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">'feedid'</span><span class="p">:</span><span class="n">feedid</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">cookies</span><span class="p">)</span>

<span class="c"># step3 use selenium to test frontend effect, eg. a thumbs up symbol</span>
<span class="c"># selenium webdriver functions here</span>
</pre>


<h4>Supporting different environments</h4>
<p>We have 3 sets of development environments (demo --&gt; pilot --&gt; production). To switch among these 3 seamlessly, I created a <code>config.ini</code> file writing down the environment-specific variables (eg. base URL, test account login, test post contents, etc.) for each environment, and pass this config (using the excellent <a href="https://pypi.python.org/pypi/configobj">configobj</a> module) when initializing each test suite:</p>
<p>So I have a utility function like below:</p>
<pre class="code literal-block"><span class="c">#utils.py</span>

<span class="kn">from</span> <span class="nn">configobj</span> <span class="kn">import</span> <span class="n">ConfigObj</span>

<span class="k">def</span> <span class="nf">read_env</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="s">'config.ini'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">env</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">env</span> <span class="o">+</span> <span class="s">'_baseurl'</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="n">env</span> <span class="o">+</span> <span class="s">'_account'</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="n">env</span> <span class="o">+</span> <span class="s">'_passwd'</span><span class="p">]</span>
</pre>


<p>Then in each test suite script I add a customized <code>__init__</code> call that will initialize properties to respective values according to the passed environment, these values can then be used in later testing functions:</p>
<p>For example:</p>
<pre class="code literal-block"><span class="c"># test_suite_1.py</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">read_env</span>

<span class="k">class</span> <span class="nc">TestSuite1</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestSuite1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="s">'test_case_1'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passwd</span> <span class="o">=</span> <span class="n">read_env</span><span class="p">(</span><span class="n">en</span><span class="p">)</span>
</pre>


<p>Then I have a master file controlling the complete test run:</p>
<pre class="code literal-block"><span class="c"># run.py</span>

<span class="kn">from</span> <span class="nn">test_suite_1</span> <span class="kn">import</span> <span class="n">TestSuite1</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>

    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSuite1</span><span class="p">(</span><span class="n">env</span><span class="p">))</span> <span class="c"># initialize with specific env</span>

    <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
</pre>


<p>To make things easier I also add a bash alias in <code>.bash_aliases</code>:</p>
<pre class="code literal-block"><span class="nb">alias </span><span class="nv">mftest</span> <span class="o">=</span> <span class="s1">'xvfb-run --server-num=10 python /path/to/tests/run.py'</span>
</pre>


<p>In this way the complete test process can be kicked off by simply running <code>mftest &lt;env&gt;</code> where <code>&lt;env&gt;</code> can be either <code>demo</code> or <code>pilot</code> or <code>prod</code>, and the program will pick up the right config.</p>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/how-to-insert-pictures-into-posts-in-nikola.html" class="u-url">How to insert images into posts in Nikola</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/how-to-insert-pictures-into-posts-in-nikola.html" rel="bookmark"><time class="published dt-published" datetime="2014-05-19T00:19:35+00:00" itemprop="datePublished" title="Publication date">2014-05-19 00:19</time></a></p>
                <p class="commentline">
        
    <a href="posts/how-to-insert-pictures-into-posts-in-nikola.html#disqus_thread" data-disqus-identifier="cache/posts/how-to-insert-pictures-into-posts-in-nikola.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<p>Since it took me a surprisingly long time to solve this simple problem -- it's not in Nikola's <a href="http://getnikola.com/handbook.html">official docs</a>(where they only have a section on galleries) and my Google search was unfruitful, I thought I'd write it down.</p>
<p>The simple trick is based on the fact that Nikola will automatically copy all contents under <code>files/</code> folder to <code>output/</code> folder when you run <code>nikola build</code>.</p>
<p>So here are the steps:</p>
<ol>
<li>
<p>Create a subdirectory in <code>files/</code>. Say <code>regex_pic/</code> (where I put my images for the previous post on <a href="http://xysun.github.io/posts/regex-parsing-thompsons-algorithm.html">parsing regex</a>) -- this is more about better practice, since I don't like to clutter my <code>output/</code> folder. </p>
</li>
<li>
<p>Put your images into that folder. </p>
</li>
<li>
<p>In your post, use regular markdown syntax to reference those images. For example: <code>![simple image1](/regex_pic/simple1.jpg)</code> will insert <code>regex_pic/simple1.jpg</code>. </p>
</li>
<li>
<p><code>nikola build</code>. Done.</p>
</li>
</ol>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/regex-parsing-thompsons-algorithm.html" class="u-url">Regex parsing: Thompson's algorithm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/regex-parsing-thompsons-algorithm.html" rel="bookmark"><time class="published dt-published" datetime="2014-05-18T22:26:11+00:00" itemprop="datePublished" title="Publication date">2014-05-18 22:26</time></a></p>
                <p class="commentline">
        
    <a href="posts/regex-parsing-thompsons-algorithm.html#disqus_thread" data-disqus-identifier="cache/posts/regex-parsing-thompsons-algorithm.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<p>This is a repost of my previous blog article at the old domain. </p>
<p>Source code can be found <a href="https://github.com/xysun/regex">here</a></p>
<h3>Theory</h3>
<p>The central idea behind a regex engine is non-deterministic automata, NFA. While the name is scary, it is just a state machine which can transit to other state machines on certain characters or nothing (which is called an "epsilon transition")</p>
<p>For example, below is an NFA for the simple concatenation regex <code>ab</code>: </p>
<p><img alt="simple regex1" src="regex_pic/simple1.jpg"></p>
<p><code>s0</code> is the start state. It can accept one character 'a' and transform to state <code>s1</code>. Similarly <code>s1</code> can only accept one character 'b' and transfer to state <code>s2</code>. <code>s2</code> is the final state, if we have exhausted the input string and the current state is a final state, the pattern matching is successful. </p>
<p>Below is a slightly more complicated example, matching <code>a?a</code>: </p>
<p><img alt="simple regex2" src="regex_pic/simple2.jpg"></p>
<p>Here the transition with an epsilon means a state can transform into the next state without any input. Therefore this combined NFA matches both <code>aa</code> and <code>a</code>, i.e. <code>a?a</code>. </p>
<p>To build a regex engine is just to build an NFA corresponding to the input regex pattern, which can be done similarly as parsing arithmetic expressions, i.e. push individual NFAs for individual characters onto a stack, upon seeing an operator, eg star/question mark/alternation/concatenation, pop NFAs from the stack, connecting the popped NFAs to form a new NFA and push back onto the stack again. </p>
<p>I recommend these two excellent articles on NFA. <a href="http://perl.plover.com/Regex/article.html">1. How Regexes Work </a> <a href="http://swtch.com/~rsc/regexp/regexp1.html">2. Regular Expression Matching Can be Simple and Fast</a></p>
<h3>Thompson's algorithm</h3>
<p>The difference between Thompson's algorithm and the current backtracking implementation in Python/Ruby/... lies in the treatment for multiple transitions. Backtracking algorithm tracks only one transition at one step (always choose the greedy transition) and backtrack to another route if current route fails, while Thompson's algorithm tracks all possible transitions simultaneously. </p>
<p>Take the above <code>a?a</code> for example, suppose we are matching an input string of <code>a</code> to this NFA. The backtracking algorithm will try the <code>a</code> transition from <code>s0</code> to <code>s1</code> first since it is greedy, but this route fails since input is exhausted at non-final state <code>s1</code>, so the algorithm backtracks to <code>s0</code> and choose the epsilon transition this time, and is able to arrive at the final state <code>s2</code> correctly. On the other hand, Thompson's algorithm will try to track both <code>a</code> and epsilon transition simultaneously. Before it reads anything, both <code>s0</code> and <code>s1</code> are considered as starting states since <code>s0</code> can transit into <code>s1</code> without any input. Now after reading the only character <code>a</code>, only <code>s1</code> will successfully transit into final state <code>s2</code>, and the matching completes. </p>
<p>This means Thompson's algorithm will significantly perform better over some pathological input patterns such as <code>a?a?a?aaa</code> matching <code>aaa</code>, since time complexity is exponential for backtracking algorithm and only linear for Thompson's algorithm.</p>
<h3>Code</h3>
<p>First step is to convert an input string into post-fix tokens, and add concatenation in the right place. A simple lexer and recursive-descent parser is used for this stage, following the grammar below (for detailed lexing and parsing code please refer to the source code):</p>
<pre class="code literal-block"><span class="n">Grammar</span> <span class="k">for</span> <span class="n">regex</span><span class="o">:</span>

<span class="n">regex</span> <span class="o">=</span> <span class="n">exp</span> <span class="err">$</span>

<span class="n">exp</span>      <span class="o">=</span> <span class="n">term</span> <span class="p">[</span><span class="o">|</span><span class="p">]</span> <span class="n">exp</span>      <span class="p">{</span><span class="n">push</span> <span class="sc">'|'</span><span class="p">}</span>
         <span class="o">|</span> <span class="n">term</span>
         <span class="o">|</span>                   <span class="n">empty</span><span class="o">?</span>

<span class="n">term</span>     <span class="o">=</span> <span class="n">factor</span> <span class="n">term</span>       <span class="n">chain</span> <span class="p">{</span><span class="n">add</span> <span class="err">\</span><span class="n">x08</span><span class="p">}</span>  <span class="err">#</span> <span class="err">\</span><span class="n">x08</span> <span class="n">is</span> <span class="n">used</span> <span class="n">as</span> <span class="n">CONCAT</span> <span class="n">token</span>
         <span class="o">|</span> <span class="n">factor</span>

<span class="n">factor</span>   <span class="o">=</span> <span class="n">primary</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span>       <span class="n">star</span> <span class="p">{</span><span class="n">push</span> <span class="sc">'*'</span><span class="p">}</span>
         <span class="o">|</span> <span class="n">primary</span> <span class="p">[</span><span class="o">+</span><span class="p">]</span>       <span class="n">plus</span> <span class="p">{</span><span class="n">push</span> <span class="sc">'+'</span><span class="p">}</span>
         <span class="o">|</span> <span class="n">primary</span> <span class="p">[</span><span class="o">?</span><span class="p">]</span>       <span class="n">optional</span> <span class="p">{</span><span class="n">push</span> <span class="sc">'?'</span><span class="p">}</span>
         <span class="o">|</span> <span class="n">primary</span>

<span class="n">primary</span>  <span class="o">=</span> <span class="err">\</span><span class="p">(</span> <span class="n">exp</span> <span class="err">\</span><span class="p">)</span>
         <span class="o">|</span> <span class="kt">char</span>              <span class="n">literal</span> <span class="p">{</span><span class="n">push</span> <span class="kt">char</span><span class="p">}</span>
</pre>


<p>A very simple class is enough to simulate an NFA:</p>
<pre class="code literal-block"><span class="k">class</span> <span class="nc">State</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># epsilon-closure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># a dictionary of char --&gt; state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_end</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># is it the ending state?</span>
</pre>


<p>Next we read one token at a time, perform relevant NFA transformations and push the transformed NFA onto a stack. For example, when seeing a CONCAT token, pop two NFAs from the stack, chain these two NFAs together and create a new CONCAT NFA, and push the new NFA onto the stack again. When all the tokens are consumed, there should be only one  NFA left on the stack. Details on how to construct NFAs can be found either from the two articles cited above, or from the book <a href="http://www.amazon.com/Compilers-Principles-Techniques-Tools-Edition/dp/0321486811">Compilers: Principles Techniques and Tools</a></p>
<p>A <code>handler</code> class is used for this step, the class has a dictionary of different handlers for each type of tokens. </p>
<pre class="code literal-block"><span class="k">class</span> <span class="nc">Handler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'CHAR'</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_char</span><span class="p">,</span> <span class="s">'CONCAT'</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_concat</span><span class="p">,</span>
                         <span class="s">'ALT'</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_alt</span><span class="p">,</span> <span class="s">'STAR'</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_rep</span><span class="p">,</span>
                         <span class="s">'PLUS'</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_rep</span><span class="p">,</span> <span class="s">'QMARK'</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_qmark</span><span class="p">}</span>
</pre>


<p>These steps above form the exposed <code>compile</code> function, which turns an input regex string into an NFA machine. </p>
<pre class="code literal-block"><span class="kn">from</span> <span class="nn">parse</span> <span class="kn">import</span> <span class="n">Lexer</span><span class="p">,</span> <span class="n">Parser</span><span class="p">,</span> <span class="n">Token</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="n">NFA</span><span class="p">,</span> <span class="n">Handler</span>

<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

    <span class="n">lexer</span> <span class="o">=</span> <span class="n">Lexer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">(</span><span class="n">lexer</span><span class="p">)</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

    <span class="n">handler</span> <span class="o">=</span> <span class="n">Handler</span><span class="p">()</span>

    <span class="n">nfa_stack</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">](</span><span class="n">t</span><span class="p">,</span> <span class="n">nfa_stack</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfa_stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="c"># check there is only one final NFA on the stack</span>
    <span class="k">return</span> <span class="n">nfa_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> 
</pre>


<p>Next we can feed the constructed NFA a string and check whether it is accepted or not. The <code>match</code> function uses two <code>sets</code> to hold <code>current_state</code> and <code>next_state</code>, make each <code>char</code> transitions and epsilon transitions and check if any ending state is arrived:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
       <span class="n">current_states</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">addstate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">current_states</span><span class="p">)</span> <span class="c"># addstate makes epsilon transitions</span>

       <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
           <span class="n">next_states</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
           <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">current_states</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                   <span class="n">trans_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">addstate</span><span class="p">(</span><span class="n">trans_state</span><span class="p">,</span> <span class="n">next_states</span><span class="p">)</span>

           <span class="n">current_states</span> <span class="o">=</span> <span class="n">next_states</span> 

       <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">current_states</span><span class="p">:</span> <span class="c">#check if any ending state reached, if so, return match</span>
           <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_end</span><span class="p">:</span>
               <span class="k">return</span> <span class="bp">True</span>
       <span class="k">return</span> <span class="bp">False</span>
</pre>


<h3>Performance</h3>
<p>Benchmarking with Python's built-in <code>re</code> module, over normal inputs (from <a href="http://www2.research.att.com/~gsf/testregex/">Glenn Fowler's test suite</a>, Python performs better, which is as expected since I didn't do any optimization. But the average speed is fast for both algorithms -- less than 1ms.</p>
<p><img alt="performance 1" src="regex_pic/plot_normal.jpg"></p>
<p>However, when tested with those pathological inputs, Thompson's algorithm is a clear win, specifically Python will hang when <code>n</code> is over 25. Notice the time scale is in seconds rather than in milliseconds in the previous plot. </p>
<p><img alt="performance 2" src="regex_pic/plot_path.jpg"></p>
<p>Russ Cox wrote about <a href="http://swtch.com/~rsc/regexp/regexp1.html">history behind regex implementation</a> (last section).</p>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/install-llvm-ocaml-bindings-and-toplevel.html" class="u-url">Install LLVM OCaml bindings (and UTop)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/install-llvm-ocaml-bindings-and-toplevel.html" rel="bookmark"><time class="published dt-published" datetime="2014-05-06T23:27:24+00:00" itemprop="datePublished" title="Publication date">2014-05-06 23:27</time></a></p>
                <p class="commentline">
        
    <a href="posts/install-llvm-ocaml-bindings-and-toplevel.html#disqus_thread" data-disqus-identifier="cache/posts/install-llvm-ocaml-bindings-and-toplevel.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<p>I put on a <a href="http://stackoverflow.com/questions/20002608/llvm-ocaml-bindings">Stackoverflow answer here</a></p>
<ol>
<li>
<p>Build LLVM with configuration: <code>--with-ocaml-libdir =</code>ocamlc -where``</p>
</li>
<li>
<p>To compile LLVM codes: <code>ocamlc -cc g++ llvm.cma test.ml -o test</code></p>
</li>
<li>
<p>To make UTop work: </p>
<ul>
<li>
<p>create a <code>myutop_main.ml</code> file with: <code>let () = UTop_main.main ()</code></p>
</li>
<li>
<p>create a custom <code>llvmutop</code>: <code>ocamlfind ocamlmktop -o llvmutop -thread -linkpkg -package utop llvm.cma myutop_main.ml -cc g++</code></p>
</li>
</ul>
</li>
<li>
<p>If you just want OCaml's build-in toplevel:</p>
<ul>
<li><code>ocamlmktop -o llvmtop llvm.cma -cc g++</code></li>
</ul>
</li>
</ol>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/week-20140504.html" class="u-url">Week 20140504</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/week-20140504.html" rel="bookmark"><time class="published dt-published" datetime="2014-05-01T22:24:37+00:00" itemprop="datePublished" title="Publication date">2014-05-01 22:24</time></a></p>
                <p class="commentline">
        
    <a href="posts/week-20140504.html#disqus_thread" data-disqus-identifier="cache/posts/week-20140504.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<h4><a href="http://courses.cs.washington.edu/courses/cse341/13sp/#lectures">Dan Grossman</a></h4>
<ul>
<li>Syntax, semantics, idioms, libraries, tools</li>
<li>records: <code>#field_name record_name</code>
</li>
<li>tuples are syntax sugers of records (field_name = 1, 2, 3...)</li>
<li>
<code>datatype</code> bindings: <code>Constant of int | Add of expr * expr</code>
</li>
<li>pattern matching: <code>case x of =&gt;</code>
</li>
<li>one-of (Option); each-of (Records)</li>
<li>type synonym: <code>type name = t</code>. <code>type card = suit * rank</code>
</li>
<li>polymorphic datatype: <code>datatype 'a option = NONE | SOME of 'a</code>
</li>
<li>
<code>val p = e</code>. <code>p</code> --&gt; patterns</li>
<li><code>fun f p = e</code></li>
<li>
<code>exception</code>, <code>raise</code>
</li>
<li><code>e1 handle exn =&gt; e2</code></li>
<li>tail optimization: remove caller from call stack</li>
<li>the wrath of premature optimization</li>
</ul>
<hr>
<h4><a href="http://www.amazon.com/Foundation-Novels-Isaac-Asimov/dp/0553293354/ref=sr_1_1?ie=UTF8&amp;qid=1399198338&amp;sr=8-1&amp;keywords=asimov+foundation">Foundation by Isaac Asimov</a></h4>
<p>(Notes generated by my little <a href="https://gist.github.com/xysun/9837480">Kindle script</a></p>
<ul>
<li>If you're born in a cubicle and grow up in a corridor, and work in a cell, and vacation in a crowded sun-room, then coming up into the open with nothing but sky over you might just give you a nervous breakdown. </li>
<li>I don't care an electron</li>
<li>And when Onum Barr stepped into his little garden early the next morning, he found a box at his feet. It contained provisions, concentrated provisions such as one would find aboard ship, and alien in taste and preparation. But they were good, and lasted long. </li>
<li>The whole war is a battle between those two systems, between the Empire and the Foundation; between the big and the little. </li>
</ul>
<hr>
<h4><a href="http://en.wikipedia.org/wiki/Maximum_subarray_problem">Max sub-array problem</a></h4>
<pre class="code literal-block"><span class="n">def</span> <span class="n">max_sub_array</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">:</span>
    <span class="n">max_ending_here</span> <span class="o">=</span> <span class="n">max_so_far</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">begin</span> <span class="o">=</span> <span class="n">begin_temp</span> <span class="o">=</span> <span class="n">end</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">len</span><span class="p">(</span><span class="n">l</span><span class="p">))</span><span class="o">:</span>
        <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">max_ending_here</span><span class="o">:</span>
            <span class="n">max_ending_here</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">begin_temp</span> <span class="o">=</span> <span class="n">i</span>
        <span class="nl">else:</span>
            <span class="n">max_ending_here</span> <span class="o">+=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">max_ending_here</span> <span class="o">&gt;=</span> <span class="n">max_so_far</span><span class="o">:</span>
            <span class="n">max_so_far</span> <span class="o">=</span> <span class="n">max_ending_here</span>
            <span class="n">begin</span> <span class="o">=</span> <span class="n">begin_temp</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">i</span>

    <span class="k">return</span> <span class="n">max_so_far</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span>
</pre>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/app-jamming-2014.html" class="u-url">App Jamming 2014</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/app-jamming-2014.html" rel="bookmark"><time class="published dt-published" datetime="2014-04-19T23:00:23+00:00" itemprop="datePublished" title="Publication date">2014-04-19 23:00</time></a></p>
                <p class="commentline">
        
    <a href="posts/app-jamming-2014.html#disqus_thread" data-disqus-identifier="cache/posts/app-jamming-2014.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<h4>App Jamming 2014</h4>
<p>I was at my friend Michelle's app jamming 2014 event yesterday as a mentor. This is my first such experience and I thought I'd make a note, mostly because it was fun, partly because I really need to pick up blogging again.</p>
<p>(I'll post pictures once I get them)</p>
<p>App jamming is an annual event where we teach teenage girls (mostly age 11-15) to code with the help of <a href="http://ai2.appinventor.mit.edu/">MIT App inventor</a>. This year is the second year and around 50 girls signed up. </p>
<p>Most girls have never written a line of code before. Because of this I was a bit reserved about the idea of writing an app, since in my mind writing an app is not necessary the best introduction to programming. But it turned out alright, and in hindsight, I think making an app has its unique advantages: </p>
<ul>
<li>
<p>Better interaction, with UI</p>
<p>MIT app inventor is awesome in that the build process is very simple and elegant -- just scan a QR code and the app would run on an Android phone. </p>
<p>Kids were over the moon when they made the first app, "HelloPurr", where you can pat a cat and it will "meow". The room was filled with "meow"s and I don't think a traditional "Hello world" would have the same effect. (When I wrote my Hello world I emailed the .exe to my parents only to find out they were disappointed, my mom was like, "I thought there would be music!")</p>
</li>
<li>
<p>Programming with blocks</p>
<p>The app inventor uses the same idea behind <a href="http://scratch.mit.edu/">Scratch</a>, also from MIT, where you write programs by dragging logic blocks. While I am still a bit suspicious on whether this will foster the right logic thinking, it is indeed a straightforward-yet-not-scaring introduction of programming, since you don't need a text editor at all. </p>
</li>
</ul>
<p>Along the way I've noticed a few interesting things:</p>
<ul>
<li>Most kids' favorite app is instagram! I've never ever used instagram. Gesus I feel so old. </li>
<li>
<p>Most kids' want to be invisible if they could have one superpower. </p>
<p>I...never...thought about that. I only wished I could have more time than others (there was an episode in Doraemon where Nobi can stop the world's time and go to do whatever he wants and restarts world's time again. I remember watching this and thinking, I really really want to do the same. </p>
<p>Is it because parents nowadays are way too harsh on their kids? </p>
</li>
<li>
<p>Unfortunately, they also have amazingly short attention spans. </p>
<p>I think it is partly due to the iPad-dominated world right now. I try to help on this as much as possible, by never giving answers straight away but rather guide them through the thinking process ("How do you want to make the ants move? What would happen when the hand crashes with the ant? And what's the right function to do that? Do you think <code>collide</code> is a good choice? Why?") But I don't think it helps much, especially during such short time. </p>
</li>
</ul>
<hr>
<p>Overall it was fun. Kids were a bit quiet in the very first beginning but jumping around soon after they made the kitten meow. There was a moment during the lunch break, where we accidentally realized that while all the mentors were chatting in the lunch area, all the kids were at their table, focused on their app. That was beautiful and precious. </p>
<p>As Michelle put it, we are working hard at bringing more girls (also with the newly founded <a href="http://womenwhocodehk.com/">Women Who Code HK</a>) into programming because we no longer want to be outliers in this industry. And so far things look promising. </p>
<p>(There was a girl at my table who participated last year, and fell in love with programming. This year she is graduating from high school and she is picking computer science as her major. I was talking to her and telling her she would have a great adventure and we were both excited. It's really fulfilling to see we actually made an impact. )</p>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/week-20140420.html" class="u-url">Week 20140420</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/week-20140420.html" rel="bookmark"><time class="published dt-published" datetime="2014-04-14T21:41:33+00:00" itemprop="datePublished" title="Publication date">2014-04-14 21:41</time></a></p>
                <p class="commentline">
        
    <a href="posts/week-20140420.html#disqus_thread" data-disqus-identifier="cache/posts/week-20140420.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<h4><a href="https://www.youtube.com/watch?v=St9cL47_1GI">Advanced technique for web functional testing</a></h4>
<ul>
<li>test responsive: <code>self.driver.set_window_size</code>
</li>
<li>Needle -- test by comparing screenshots</li>
<li>Saucelabs</li>
<li><a href="http://davehaeffner.com/selenium-guidebook/">the selenium guidebook</a></li>
<li>selenium testing tools cookbook</li>
</ul>
<hr>
<h4><a href="http://blog.miguelgrinberg.com/post/easy-web-scraping-with-python">Web scraping with Python</a></h4>
<ul>
<li><code>multiprocessing.Pool</code></li>
<li>
<code>argparse</code> module</li>
</ul>
<hr>
<h4>Micellaneous</h4>
<ul>
<li>
<p><a href="http://www.artima.com/weblogs/viewpost.jsp?thread=240845">decorators with arguments</a></p>
</li>
<li>
<p>manually create swap file</p>
<p>Recently when I try to update the <code>opam</code> on my <a href="https://www.digitalocean.com/?refcode=52476c7ad3e1">DigitalOcean</a> server, the below error pop up: </p>
<p>opam: "fork" failed: Cannot allocate memory.</p>
<p>It is due to lack of RAM memory. The solution is to create a swap file. I followed the instructions <a href="http://wiki.paparazziuav.org/wiki/GettingTheGCSRunningonAGumstixBoard">here</a>, note to compile <code>core</code> a 512MB swap is not enough, I ended up creating a 1G swap. DigitalOcean also has a nice article on <a href="https://www.digitalocean.com/community/articles/how-to-add-swap-on-ubuntu-12-04">creating swap files</a></p>
</li>
</ul>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/week-20140406.html" class="u-url">Week 20140406</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/week-20140406.html" rel="bookmark"><time class="published dt-published" datetime="2014-03-31T13:32:10+00:00" itemprop="datePublished" title="Publication date">2014-03-31 13:32</time></a></p>
                <p class="commentline">
        
    <a href="posts/week-20140406.html#disqus_thread" data-disqus-identifier="cache/posts/week-20140406.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<h4>Dan Grossman</h4>
<ul>
<li>functions over lists are usually recursive: empty list; non-empty list (<code>hd</code>, <code>tl</code>) </li>
<li>let expression: <code>let...in...end</code>
</li>
<li>Do a recursive computation, store in (local binding)</li>
<li>Option: <code>isSome</code>, <code>valOf</code>
</li>
<li>Bool comparisons: <code>andalso</code>, <code>orelse</code>, <code>not</code>
</li>
<li>
<code>real</code> is not an equality type (subject to round errors)</li>
<li>no mutation --&gt; no need to worry about alias or copies --&gt; implementation more efficient &amp; better security</li>
<li>Done <a href="https://github.com/xysun/armory/tree/master/ProgrammingLanguages">HW1</a>
</li>
</ul>
<h4><a href="https://www.youtube.com/watch?v=fYlnfvKVDoM">Brandon Rhodes Pycon talk</a></h4>
<ul>
<li><a href="http://duartes.org/gustavo/blog/post/what-your-computer-does-while-you-wait/">Gustavo Duarte -- what your computer does while you wait</a></li>
<li><a href="http://danluu.com/3c-conflict/">Dan Luu -- how misaligning data can increase performance 12x</a></li>
<li>Python store general purpose data structures (eg. tuple) as array of addresses</li>
<li>
<code>append</code> on a list adds extra spaces -- amortization</li>
<li>list is fast for tail operations: <code>append</code>, <code>pop</code>. Not <code>pop(0)</code>, <code>insert(0)</code>
</li>
<li>
<code>dict</code> is an array with keys stored at integer indexes according to hash value: <ul>
<li>hash -- key address -- value address</li>
<li>PyCon 2010 "The mighty dictionary"</li>
<li>can build compound keys with tuple</li>
</ul>
</li>
<li>set: dictionary with no keys</li>
<li>
<code>deque</code>, <code>heapq</code>
</li>
<li>2013 PyCon, the clean architecture in Python</li>
</ul>
<hr>
<h4>Miscellaneous</h4>
<ul>
<li>
<a href="https://www.rescuetime.com/">rescue time</a> is a neat productivity tool.</li>
</ul>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/week-20140330.html" class="u-url">Weekly 20140330</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/week-20140330.html" rel="bookmark"><time class="published dt-published" datetime="2014-03-24T21:09:02+00:00" itemprop="datePublished" title="Publication date">2014-03-24 21:09</time></a></p>
                <p class="commentline">
        
    <a href="posts/week-20140330.html#disqus_thread" data-disqus-identifier="cache/posts/week-20140330.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<h4><a href="http://www.amazon.com/Surely-Feynman-Adventures-Curious-Character/dp/0393316041">Surely You're joking, Mr. Feynman!</a></h4>
<blockquote>
<p>Learn what the rest of the world is like. The variety is worthwhile.</p>
<p>"I could do that, but I won't" -- which is just another way of saying that you can't. </p>
<p>You don't have to be responsible for the world that you're in.</p>
<p>You have no responsibility to live up to what other people think you ought to accomplish. </p>
</blockquote>
<hr>
<h4><a href="http://courses.cs.washington.edu/courses/cse341/13sp/videos/unit1/">Dan Grossman</a></h4>
<ul>
<li>expression: syntax, type-checking, evaluate</li>
<li>REPL: Read, Evaluate, Print, Loop; do not type <code>use</code> without restarting REPL</li>
<li>syntax: <ul>
<li>negation: <code>~5</code>
</li>
<li>division: <code>div</code>
</li>
</ul>
</li>
<li>after expression evaluated, the expression producing the result is irrelevant --&gt; do not reuse <code>use</code> in sml</li>
<li>access pair/tuple: <code>#1 e</code>
</li>
<li>naming: <ul>
<li>
<code>pair</code> &lt;--&gt; <code>pr</code>
</li>
</ul>
</li>
</ul>
<hr>
<h4><a href="http://c.learncodethehardway.org/book/">Learn C the hard way</a></h4>
<ul>
<li>
<a href="http://c.learncodethehardway.org/book/ex13.html">switch statement</a>: <ul>
<li>
<code>return 1</code> --&gt; tell OS there's an error</li>
<li>only integers allowed (eg. char)</li>
</ul>
</li>
<li>
<a href="http://c.learncodethehardway.org/book/ex14.html">use functions</a><ul>
<li>forward declaration: use function before defining them</li>
</ul>
</li>
<li><a href="http://c.learncodethehardway.org/book/ex15.html">pointers</a></li>
</ul>
<hr>
<h4>Miscellaneous</h4>
<ul>
<li>
<p>I wrote a small <a href="https://gist.github.com/xysun/9837480">utility</a> to manage my "My Clippings.txt" from Kindle. This script will create a separate note for each book. </p>
</li>
<li>
<p><a href="http://defunkt.io/gist/">gist</a> is an awesome command line tool for gist. </p>
</li>
<li>
<p>use <code>rlwrap sml</code> to enable history rollback through arrow keys</p>
</li>
</ul>
</div>
    </div>
    </article>
    <article class="h-entry post-text">
    <header>
        <h1 class="p-name entry-title"><a href="posts/week-20140323.html" class="u-url">Weekly 20140323</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Xiayun Sun</span></p>
            <p class="dateline"><a href="posts/week-20140323.html" rel="bookmark"><time class="published dt-published" datetime="2014-03-20T19:52:36+00:00" itemprop="datePublished" title="Publication date">2014-03-20 19:52</time></a></p>
                <p class="commentline">
        
    <a href="posts/week-20140323.html#disqus_thread" data-disqus-identifier="cache/posts/week-20140323.html">Comments</a>


        </p>
</div>
    </header>
    <div class="e-content entry-content">
    <div>
<h4><a href="http://sahandsaba.com/thirty-python-language-features-and-tricks-you-may-not-know.html">30 Python language features and tricks</a></h4>
<ul>
<li>Extended unpacking</li>
</ul>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
</pre>


<ul>
<li>List slices with negative step</li>
</ul>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre>


<ul>
<li>Name slices (<code>slice(start, end, slice)</code>)</li>
</ul>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">LASTTHREE</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="n">LASTTHREE</span><span class="p">]</span>
<span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
</pre>


<ul>
<li>Dictionary comprehension</li>
</ul>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span>
<span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">15</span><span class="p">}</span>
</pre>


<ul>
<li>Named tuples</li>
</ul>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">Point</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">'Point'</span><span class="p">,</span> <span class="p">[</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span>
<span class="mi">13</span>
</pre>


<ul>
<li>Use capital letter for set variables</li>
<li>Counter</li>
</ul>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="n">Counter</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</pre>


<ul>
<li>
<code>collections.deque</code> Double-ended queue</li>
<li>default dict</li>
</ul>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="p">[</span><span class="s">'a'</span><span class="p">]</span>
<span class="mi">0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="p">[</span><span class="s">'a'</span><span class="p">]</span>
<span class="s">''</span>
</pre>


<hr>
<h4><a href="http://stackoverflow.com/questions/4431922/link-encryption-with-django-and-python">Simple URL encryption</a></h4>
<p>Append a KEY string (with an easy delimitor) to the ID field, then use <code>base64.urlsafe_b64encode</code> and <code>base64.urlsafe_b64decode</code></p>
<hr>
<h4><a href="https://github.com/mjhea0/flaskr-tdd">flaskr-tdd</a></h4>
<ul>
<li>
<p>TDD: </p>
<ol>
<li>write a test</li>
<li>run the test (it should fail)</li>
<li>write just enough code to pass the test</li>
<li>refactor</li>
</ol>
</li>
<li>
<p>Flask test client</p>
</li>
</ul>
<pre class="code literal-block"><span class="n">tester</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s">"html/text"</span><span class="p">)</span>
<span class="c"># response.data include all html text</span>
</pre>


<ul>
<li>
<p><a href="http://flask.pocoo.org/docs/patterns/flashing/">Flask flash system</a>: <code>get_flashed_messages</code> --&gt; may be useful for client-side validation</p>
</li>
<li>
<p><code>url_for('static', filename = 'style.css')</code></p>
</li>
</ul>
<hr>
<h4><a href="http://majutsushi.github.io/tagbar/">Install tagbar on vim</a></h4>
<ul>
<li>create .vim/ if not exist</li>
<li>Install exuberant ctags</li>
<li>Install tagbar</li>
</ul>
<pre class="code literal-block"><span class="nb">cd</span> ~/.vim
git clone git://github.com/majutsushi/tagbar
mv tagbar/* .  <span class="c"># must be directly under .vim/</span>
sudo rm -r tagbar/
<span class="nb">cd </span>doc/
vim tagbar.txt
:helptags .
<span class="c"># quit vim</span>
</pre>


<ul>
<li>edit <code>.vimrc</code> (below is mine): </li>
</ul>
<pre class="code literal-block"><span class="nb">let </span>g:tagbar_ctags_bin<span class="o">=</span><span class="s1">'/usr/local/bin/ctags'</span> <span class="c"># change to ctags bin path, this is on MacOS</span>
<span class="nb">let </span>g:tagbar_width<span class="o">=</span>40
noremap &lt;silent&gt; tb :TagbarOpen fj &lt;CR&gt;
</pre>


<ul>
<li>useful key shortcuts:</li>
</ul>
<pre class="code literal-block">tb: open tagbar <span class="c"># my key binding</span>
p: go to tag, stay in tagbar
&lt;enter&gt;: go to tag
o: toggle fold
*: open all <span class="nv">fold</span>
<span class="o">=</span>: collapse all fold
?: keymap <span class="nb">help</span>
</pre>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager">
        <ul class="pager">
            <li class="next">
                <a href="index-1.html" rel="next">Older posts</a>
            </li>
        </ul>
        </nav>


        
       <script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>





        </div>
        <!--End of body content-->

        <footer>
            Contents  2014         <a href="mailto:">Xiayun Sun</a> - Powered by         <a href="http://getnikola.com">Nikola</a>         
            
        </footer>
    </div>
</div>


            <script src="assets/js/jquery.min.js"></script>
            <script src="assets/js/bootstrap.min.js"></script>
        <script src="assets/js/jquery.colorbox-min.js"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script>jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    


</body>
</html>
